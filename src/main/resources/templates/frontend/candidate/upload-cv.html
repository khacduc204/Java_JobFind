<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{fragments/header :: head}" />
<style>
    .page-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 2rem 0;
    }
    .upload-zone {
        border: 3px dashed #dee2e6;
        border-radius: 10px;
        padding: 3rem 2rem;
        text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-zone:hover {
            border-color: #f5576c;
            background-color: #fff5f7;
        }
        .upload-zone.dragover {
            border-color: #f5576c;
            background-color: #ffe5e9;
        }
        .file-icon {
            font-size: 4rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        .cv-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <th:block th:replace="~{fragments/header :: header}" />

    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1 class="mb-2">
                <i class="fa-solid fa-file-upload"></i> Upload CV
            </h1>
            <p class="mb-0">Tải lên CV của bạn để nhà tuyển dụng dễ dàng tìm thấy</p>
        </div>
    </div>

    <!-- Content -->
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Success Message -->
                <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fa-solid fa-check-circle"></i>
                    <span th:text="${successMessage}">Upload thành công!</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Error Message -->
                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fa-solid fa-exclamation-circle"></i>
                    <span th:text="${errorMessage}">Có lỗi xảy ra!</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Current CV Section -->
                <div th:if="${currentCvPath != null}" class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="cv-preview">
                            <div class="row align-items-center">
                                <div class="col-md-2 text-center mb-3 mb-md-0">
                                    <i class="fa-solid fa-file-pdf fa-4x"></i>
                                </div>
                                <div class="col-md-7 mb-3 mb-md-0">
                                    <h5 class="mb-2">CV hiện tại của bạn</h5>
                                    <p class="mb-1">
                                        <i class="fa-solid fa-file-alt me-2"></i>
                                        <span th:text="${currentCvPath}">cv-file.pdf</span>
                                    </p>
                                    <p class="mb-0 small" th:if="${cvUpdatedAt != null}">
                                        <i class="fa-solid fa-clock me-2"></i>
                                        Cập nhật: <span th:text="${#temporals.format(cvUpdatedAt, 'dd/MM/yyyy HH:mm')}">01/01/2024</span>
                                    </p>
                                </div>
                                <div class="col-md-3 text-center">
                                    <a th:href="@{'/uploads/cv/' + ${currentCvPath}}" 
                                       class="btn btn-light btn-lg w-100 mb-2"
                                       target="_blank"
                                       download>
                                        <i class="fa-solid fa-download"></i> Tải xuống
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upload Form -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="fa-solid fa-cloud-upload-alt text-primary"></i>
                            <span th:text="${currentCvPath != null ? 'Tải lên CV mới' : 'Tải lên CV của bạn'}">Upload CV</span>
                        </h5>

                        <form th:action="@{/candidate/upload-cv}" method="post" enctype="multipart/form-data" id="uploadForm">
                            <!-- Upload Zone -->
                            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('cvFile').click()">
                                <i class="fa-solid fa-cloud-upload-alt file-icon" id="uploadIcon"></i>
                                <h5 id="uploadText">Kéo thả file CV vào đây hoặc click để chọn file</h5>
                                <p class="text-muted mb-0" id="uploadSubtext">
                                    Hỗ trợ: PDF, DOC, DOCX - Tối đa 5MB
                                </p>
                                <input type="file" 
                                       class="d-none" 
                                       id="cvFile" 
                                       name="cvFile"
                                       accept=".pdf,.doc,.docx"
                                       required
                                       onchange="handleFileSelect(event)">
                            </div>

                            <!-- Selected File Info -->
                            <div id="fileInfo" class="mt-3 d-none">
                                <div class="alert alert-info">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fa-solid fa-file-alt me-2"></i>
                                            <strong>File đã chọn:</strong>
                                            <span id="fileName"></span>
                                            <span class="ms-2 text-muted" id="fileSize"></span>
                                        </div>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearFile()">
                                            <i class="fa-solid fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                                    <i class="fa-solid fa-upload"></i> Upload CV
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fa-solid fa-lightbulb text-warning"></i> Định dạng file
                                </h6>
                                <ul class="small mb-0">
                                    <li>Chấp nhận: PDF, DOC, DOCX</li>
                                    <li>Kích thước tối đa: 5MB</li>
                                    <li>Khuyến nghị: Sử dụng định dạng PDF</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fa-solid fa-check-circle text-success"></i> Lưu ý khi tạo CV
                                </h6>
                                <ul class="small mb-0">
                                    <li>Thông tin rõ ràng, chính xác</li>
                                    <li>Trình bày gọn gàng, dễ đọc</li>
                                    <li>Tập trung vào kỹ năng và kinh nghiệm</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <h6 class="mb-2">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        Tại sao nên upload CV?
                    </h6>
                    <p class="small mb-0">
                        CV giúp nhà tuyển dụng hiểu rõ hơn về kinh nghiệm, kỹ năng của bạn. 
                        Hồ sơ có CV hoàn chỉnh sẽ tăng cơ hội được liên hệ và mời phỏng vấn cao hơn 5 lần.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <th:block th:replace="~{fragments/footer :: footer}" />
    <th:block th:replace="~{fragments/footer :: backToTop}" />
    <th:block th:replace="~{fragments/footer :: scripts}" />

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const cvFile = document.getElementById('cvFile');
        const fileInfo = document.getElementById('fileInfo');
        const submitBtn = document.getElementById('submitBtn');
        const uploadIcon = document.getElementById('uploadIcon');
        const uploadText = document.getElementById('uploadText');
        const uploadSubtext = document.getElementById('uploadSubtext');

        // Drag and drop handlers
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                cvFile.files = files;
                handleFileSelect({ target: { files: files } });
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            const allowedTypes = ['application/pdf', 'application/msword', 
                                 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                alert('Chỉ chấp nhận file PDF, DOC, DOCX');
                clearFile();
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Kích thước file không được vượt quá 5MB');
                clearFile();
                return;
            }

            // Update UI
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            fileInfo.classList.remove('d-none');
            submitBtn.disabled = false;

            // Update upload zone
            uploadIcon.className = 'fa-solid fa-file-check file-icon text-success';
            uploadText.textContent = 'File đã sẵn sàng để upload';
            uploadSubtext.textContent = 'Click "Upload CV" để hoàn tất';
        }

        function clearFile() {
            cvFile.value = '';
            fileInfo.classList.add('d-none');
            submitBtn.disabled = true;
            
            // Reset upload zone
            uploadIcon.className = 'fa-solid fa-cloud-upload-alt file-icon';
            uploadText.textContent = 'Kéo thả file CV vào đây hoặc click để chọn file';
            uploadSubtext.textContent = 'Hỗ trợ: PDF, DOC, DOCX - Tối đa 5MB';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        // Form submit handler
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Đang upload...';
        });
    </script>
</body>
</html>
